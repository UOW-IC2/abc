<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Worker Example</title>
</head>
<body>
    <a href="https://site1.com:3001">site1</a>
    <a href="https://site2.com:3002">site2</a>
    <h1>Service Worker Caching Example</h1>
    <p>This image will be cached by the Service Worker:</p>
<!--     <img src="ok.jpg" alt="Image 3" style="width:300px;height:auto;">
    <img src="1.png" alt="Image 1" style="width:300px;height:auto;"> -->

    <script src="get_script_time.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    

    <script>
 function fetchWithCacheCheck(url) {
    if ('caches' in window) {
        caches.match(url).then(cachedResponse => {
            if (cachedResponse) {
                // If the resource is found in the cache
                console.log('Serving from cache');
                return cachedResponse.text(); // Handle cached content
            } else {
                // Stop fetch entirely, no request to server
                console.log('Resource not in cache, no fetch will be made.');
                return Promise.reject('Resource not in cache, no fetch made');
            }
        }).then(scriptText => {
            if (scriptText) {
                console.log('Script content:', scriptText);
                // Optional: execute or use the script
                const script = document.createElement('script');
                script.text = scriptText;
                document.head.appendChild(script);
            }
        }).catch(error => {
            // Handle the error or case where the resource wasn't cached
            console.warn(error);
        });
    }
}

// Example usage
fetchWithCacheCheck('https://site1.com:3001/long-term-id.js');


    </script>
    
    <!-- <script src="script.js"> -->
<!--     <script type="text/javascript">
        // JavaScript to redirect the page
        //window.location.href = "https://site2.com:3002/redirect.html";
    </script> -->

    <!-- <script>
        window.addEventListener('load', function() {
            let totalSize = 0;
            let id = '';
            let resources = performance.getEntriesByType('resource');

            resources.forEach((resource) => {
                if (resource.name === 'http://localhost:3001/ok.jpg') {
                    totalSize += resource.transferSize;
                    if (resource.transferSize > 0) {
                        id = id +'1';
                    } else {
                        id = id + '0';
                    }
                }
                if (resource.name === 'http://localhost:3001/1.png') {
                    totalSize += resource.transferSize;
                    
                    if (resource.transferSize > 0) {
                        id = id +'1';
                    } else {
                        id = id + '0';
                    }
                }
            });

            console.log('Sending total size:', totalSize);
            console.log('sending id:', id);
            // Send id to the parent window
            window.parent.postMessage({ id: id }, '*');
        });
    </script> -->
</body>
</html>

